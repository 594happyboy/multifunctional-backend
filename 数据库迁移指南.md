# æ•°æ®åº“è¿ç§»æŒ‡å—

## ğŸ“‹ å˜æ›´è¯´æ˜

æœ¬æ¬¡æ›´æ–°å°†å¤šæ•°æ®åº“æ¶æ„ï¼ˆfiledb + blogdbï¼‰åˆå¹¶ä¸ºå•æ•°æ®åº“æ¶æ„ï¼ˆmultifunctional_backendï¼‰ï¼Œç®€åŒ–ç³»ç»Ÿå¤æ‚åº¦ã€‚

### å˜æ›´å†…å®¹

| é¡¹ç›® | å˜æ›´å‰ | å˜æ›´å |
|------|--------|--------|
| æ•°æ®åº“æ•°é‡ | 2ä¸ªï¼ˆfiledb, blogdbï¼‰ | 1ä¸ªï¼ˆmultifunctional_backendï¼‰ |
| é…ç½®å¤æ‚åº¦ | éœ€è¦å¤šæ•°æ®æºé…ç½® | å•æ•°æ®æºé…ç½® |
| Schema æ–‡ä»¶ | åˆ†æ•£åœ¨å„æ¨¡å— | ç»Ÿä¸€åœ¨ app-bootstrap |
| è¡¨å‘½å | æ— å‰ç¼€ | æ¨¡å—å‰ç¼€ï¼ˆfile_*, blog_*ï¼‰ |

## ğŸš€ è¿ç§»æ­¥éª¤

### æ­¥éª¤ 1ï¼šå¤‡ä»½ç°æœ‰æ•°æ®ï¼ˆå¦‚æœå·²æœ‰æ•°æ®ï¼‰

```bash
# å¦‚æœä½ ä¹‹å‰å·²ç»åˆ›å»ºäº†æ•°æ®åº“å¹¶æœ‰æ•°æ®ï¼Œè¯·å…ˆå¤‡ä»½
mysqldump -u root -p filedb > filedb_backup.sql
mysqldump -u root -p blogdb > blogdb_backup.sql
```

### æ­¥éª¤ 2ï¼šæ‰§è¡Œæ–°çš„æ•°æ®åº“åˆå§‹åŒ–è„šæœ¬

```bash
# æ–¹å¼1ï¼šä½¿ç”¨ MySQL å‘½ä»¤è¡Œå¯¼å…¥
mysql -u root -p < app-bootstrap\src\main\resources\sql\schema.sql

# æ–¹å¼2ï¼šåœ¨ MySQL å®¢æˆ·ç«¯ä¸­æ‰§è¡Œ
# æ‰“å¼€ app-bootstrap/src/main/resources/sql/schema.sql æ–‡ä»¶å¹¶æ‰§è¡Œ
```

### æ­¥éª¤ 3ï¼šéªŒè¯æ•°æ®åº“åˆ›å»ºæˆåŠŸ

```sql
-- è¿æ¥åˆ° MySQL
mysql -u root -p

-- æŸ¥çœ‹æ•°æ®åº“
SHOW DATABASES LIKE 'multifunctional_backend';

-- ä½¿ç”¨æ•°æ®åº“
USE multifunctional_backend;

-- æŸ¥çœ‹æ‰€æœ‰è¡¨
SHOW TABLES;

-- åº”è¯¥çœ‹åˆ°ä»¥ä¸‹è¡¨ï¼š
-- +-----------------------------------+
-- | Tables_in_multifunctional_backend |
-- +-----------------------------------+
-- | blog_articles                     |
-- | blog_comments                     |
-- | blog_groups                       |
-- | file_metadata                     |
-- | users                             |
-- +-----------------------------------+
```

### æ­¥éª¤ 4ï¼šå¯åŠ¨åº”ç”¨æµ‹è¯•

```bash
# åœ¨é¡¹ç›®æ ¹ç›®å½•æ‰§è¡Œ
.\å¯åŠ¨.bat

# æˆ–è€…ä½¿ç”¨ Maven å‘½ä»¤
mvn clean install
cd app-bootstrap
mvn spring-boot:run
```

### æ­¥éª¤ 5ï¼šéªŒè¯åŠŸèƒ½æ­£å¸¸

1. **è®¿é—® API æ–‡æ¡£**
   - URL: http://localhost:8080/doc.html
   - æµ‹è¯•æ–‡ä»¶ä¸Šä¼ /ä¸‹è½½åŠŸèƒ½
   - æµ‹è¯•åšå®¢ç›¸å…³æ¥å£

2. **æ£€æŸ¥æ—¥å¿—**
   ```
   åº”è¯¥çœ‹åˆ°ç±»ä¼¼è¾“å‡ºï¼š
   HikariPool-1 - Starting...
   HikariPool-1 - Added connection com.mysql.cj.jdbc.ConnectionImpl@xxxxx
   Started MultifunctionalBackendApplication in X.xxx seconds
   ```

## ğŸ“ é…ç½®å˜æ›´è¯¦æƒ…

### application.properties

**å˜æ›´å‰ï¼š**
```properties
spring.datasource.url=jdbc:mysql://localhost:3306/filedb?...
spring.datasource.secondary.url=jdbc:mysql://localhost:3306/blogdb?...
```

**å˜æ›´åï¼š**
```properties
spring.datasource.url=jdbc:mysql://localhost:3306/multifunctional_backend?...
# ç§»é™¤äº† secondary æ•°æ®æºé…ç½®
```

### MyBatisPlusConfig.kt

**å˜æ›´å‰ï¼š**
```kotlin
@MapperScan("com.zzy.file.mapper", "com.zzy.blog.mapper")
```

**å˜æ›´åï¼š**
```kotlin
@MapperScan("com.zzy.file.mapper", "com.zzy.home.mapper")
```

## ğŸ”„ æ•°æ®è¿ç§»ï¼ˆå¦‚æœæœ‰æ—§æ•°æ®ï¼‰

å¦‚æœä½ ä¹‹å‰å·²ç»æœ‰æ•°æ®éœ€è¦è¿ç§»ï¼š

### æ–¹å¼ 1ï¼šæ‰‹åŠ¨è¿ç§»è¡¨ç»“æ„å’Œæ•°æ®

```sql
-- 1. å…ˆåˆ›å»ºæ–°æ•°æ®åº“
SOURCE app-bootstrap/src/main/resources/sql/schema.sql;

-- 2. ä»æ—§åº“è¿ç§»æ–‡ä»¶æ•°æ®
USE multifunctional_backend;
INSERT INTO file_metadata 
SELECT * FROM filedb.file_metadata;

-- 3. ä»æ—§åº“è¿ç§»åšå®¢æ•°æ®
INSERT INTO users 
SELECT id, username, password_hash, email, avatar_url, 
       NULL as storage_quota, NULL as used_storage,
       created_at, created_at as updated_at, last_login_at, 
       1 as status 
FROM blogdb.users;

INSERT INTO blog_groups 
SELECT * FROM blogdb.blog_groups;

INSERT INTO blog_articles 
SELECT * FROM blogdb.blog_articles;

INSERT INTO blog_comments 
SELECT * FROM blogdb.blog_comments;
```

### æ–¹å¼ 2ï¼šä½¿ç”¨è¿ç§»è„šæœ¬ï¼ˆæ¨èï¼‰

```bash
# åˆ›å»ºè¿ç§»è„šæœ¬ migrate.sql
cat > migrate.sql << 'EOF'
-- ä½¿ç”¨æ–°æ•°æ®åº“
USE multifunctional_backend;

-- è¿ç§»æ–‡ä»¶æ¨¡å—æ•°æ®
INSERT IGNORE INTO file_metadata 
SELECT * FROM filedb.file_metadata;

-- è¿ç§»ç”¨æˆ·æ•°æ®ï¼ˆåˆå¹¶ä¸¤ä¸ª user è¡¨ï¼‰
INSERT IGNORE INTO users (id, username, password_hash, email, avatar_url, created_at, updated_at, last_login_at, status)
SELECT id, username, password_hash, email, avatar_url, created_at, created_at, last_login_at, 1
FROM blogdb.users;

-- è¿ç§»åšå®¢æ•°æ®
INSERT IGNORE INTO blog_groups SELECT * FROM blogdb.blog_groups;
INSERT IGNORE INTO blog_articles SELECT * FROM blogdb.blog_articles;
INSERT IGNORE INTO blog_comments SELECT * FROM blogdb.blog_comments;

-- éªŒè¯æ•°æ®
SELECT 'file_metadata' as table_name, COUNT(*) as count FROM file_metadata
UNION ALL
SELECT 'users', COUNT(*) FROM users
UNION ALL
SELECT 'blog_groups', COUNT(*) FROM blog_groups
UNION ALL
SELECT 'blog_articles', COUNT(*) FROM blog_articles
UNION ALL
SELECT 'blog_comments', COUNT(*) FROM blog_comments;
EOF

# æ‰§è¡Œè¿ç§»
mysql -u root -p < migrate.sql
```

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **é»˜è®¤ç®¡ç†å‘˜è´¦å·**
   - ç”¨æˆ·åï¼š`admin`
   - å¯†ç ï¼š`admin123`
   - âš ï¸ **ç”Ÿäº§ç¯å¢ƒåŠ¡å¿…ä¿®æ”¹é»˜è®¤å¯†ç ï¼**

2. **å¼€å‘ç¯å¢ƒè‡ªåŠ¨åˆå§‹åŒ–ï¼ˆå¯é€‰ï¼‰**
   å¦‚éœ€åº”ç”¨å¯åŠ¨æ—¶è‡ªåŠ¨æ‰§è¡Œ SQLï¼Œåœ¨ `application.properties` ä¸­å–æ¶ˆæ³¨é‡Šï¼š
   ```properties
   spring.sql.init.mode=always
   spring.sql.init.schema-locations=classpath:sql/schema.sql
   spring.sql.init.encoding=UTF-8
   ```

3. **æ—§çš„ schema.sql æ–‡ä»¶**
   - `module-file/src/main/resources/sql/schema.sql` - å·²æ ‡è®°ä¸ºåºŸå¼ƒ
   - `module-home/src/main/resources/sql/schema.sql` - å·²æ ‡è®°ä¸ºåºŸå¼ƒ
   - è¿™äº›æ–‡ä»¶å·²æ·»åŠ åºŸå¼ƒæç¤ºï¼Œå¯ä¿ç•™ä½œä¸ºå‚è€ƒï¼Œä¹Ÿå¯åˆ é™¤

4. **ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²**
   - å»ºè®®æ‰‹åŠ¨æ‰§è¡Œ SQL è„šæœ¬ï¼Œè€Œä¸æ˜¯ä½¿ç”¨è‡ªåŠ¨åˆå§‹åŒ–
   - ä½¿ç”¨æ•°æ®åº“è¿ç§»å·¥å…·ï¼ˆFlyway/Liquibaseï¼‰ç®¡ç†ç‰ˆæœ¬å‡çº§

## âœ… éªŒè¯æ¸…å•

- [ ] æ–°æ•°æ®åº“ `multifunctional_backend` åˆ›å»ºæˆåŠŸ
- [ ] æ‰€æœ‰è¡¨ï¼ˆ5ä¸ªï¼‰åˆ›å»ºæˆåŠŸ
- [ ] é»˜è®¤ç®¡ç†å‘˜è´¦å·æ’å…¥æˆåŠŸ
- [ ] é»˜è®¤åšå®¢åˆ†ç»„æ’å…¥æˆåŠŸ
- [ ] åº”ç”¨å¯åŠ¨æ— é”™è¯¯
- [ ] æ–‡ä»¶ä¸Šä¼ /ä¸‹è½½åŠŸèƒ½æ­£å¸¸
- [ ] åšå®¢æ¥å£åŠŸèƒ½æ­£å¸¸
- [ ] æ—¥å¿—ä¸­æ— æ•°æ®åº“è¿æ¥é”™è¯¯

## ğŸ†˜ å¸¸è§é—®é¢˜

### Q1: å¯åŠ¨æ—¶æŠ¥é”™ "Unknown database 'multifunctional_backend'"
**A:** è¯´æ˜æ•°æ®åº“æœªåˆ›å»ºï¼Œæ‰§è¡Œæ­¥éª¤2çš„ SQL è„šæœ¬

### Q2: æç¤º "Access denied for user 'root'"
**A:** æ£€æŸ¥ application.properties ä¸­çš„æ•°æ®åº“ç”¨æˆ·åå’Œå¯†ç æ˜¯å¦æ­£ç¡®

### Q3: æ—§æ•°æ®åº“å¯ä»¥åˆ é™¤å—ï¼Ÿ
**A:** åœ¨ç¡®è®¤æ–°ç³»ç»Ÿè¿è¡Œæ­£å¸¸ä¸”æ•°æ®å·²è¿ç§»åï¼Œå¯ä»¥åˆ é™¤ï¼š
```sql
DROP DATABASE IF EXISTS filedb;
DROP DATABASE IF EXISTS blogdb;
```

### Q4: å¦‚ä½•å›æ»šåˆ°å¤šæ•°æ®åº“æ¶æ„ï¼Ÿ
**A:** 
1. æ¢å¤å¤‡ä»½çš„é…ç½®æ–‡ä»¶
2. ä»å¤‡ä»½æ¢å¤æ—§æ•°æ®åº“
3. é‡æ–°éƒ¨ç½²æ—§ç‰ˆæœ¬ä»£ç 

## ğŸ“š ç›¸å…³æ–‡æ¡£

- Spring Boot æ•°æ®æºé…ç½®ï¼šhttps://docs.spring.io/spring-boot/docs/current/reference/html/data.html
- MyBatis-Plus å®˜æ–¹æ–‡æ¡£ï¼šhttps://baomidou.com/
- MySQL æ•°æ®è¿ç§»æŒ‡å—ï¼šhttps://dev.mysql.com/doc/refman/8.0/en/mysqldump.html

---

**è¿ç§»æ—¥æœŸï¼š** 2025-10-16  
**ç‰ˆæœ¬ï¼š** v2.0 - å•æ•°æ®åº“æ¶æ„

