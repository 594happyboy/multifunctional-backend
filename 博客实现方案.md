# 清爽简易风格个人博客方案

## 1. 项目背景与目标
- **背景**：基于现有 `Vue 3 + Vite` 前端项目扩展为个人博客站点，继续复用现有 Axios 封装及文件上传能力。
- **目标**：提供公众阅读文章、自由评论、按分组浏览以及作者后台维护文章的完整闭环，保持界面简洁清爽。
- **关键诉求**：
  - 文章支持 Markdown 与 PDF 两种格式。
  - 文章可配置分组与标签，访客能够快捷筛选。
  - 每篇文章跳转详情页阅读，并在底部开放游客评论（无需后台审核）。
  - 作者后台可上传、编辑、发布文章以及维护评论与站点信息。

## 2. 技术栈与依赖
- **核心框架**：Vue 3（`<script setup>`）、Vite。
- **状态管理**：Pinia（替换/扩展现有局部状态）。
- **路由管理**：Vue Router 4。
- **UI & 样式**：CSS 变量 + Tailwind Lite 或自定义原子类，保持轻量；可引入 `postcss` 进行变量处理。
- **Markdown 渲染**：`markdown-it` + `markdown-it-anchor` + `highlight.js`。
- **PDF 预览**：`pdfjs-dist`（内嵌 viewer）或轻量第三方组件。
- **评论编辑**：原生 `<textarea>` + `@vueuse/core` 辅助节流。
- **表单与校验**：`vee-validate` 或自定义组合式校验逻辑。
- **HTTP**：沿用 `axios` 封装（`src/api/request.js`）。
- **构建与部署**：Vite 构建、Nginx/静态托管。

## 3. 系统角色与权限
| 角色 | 权限 | 说明 |
| --- | --- | --- |
| 游客 | 浏览文章、搜索、按分组/标签过滤、提交评论（即时展示）、编辑/删除自己未登录状态下的评论限时 15 分钟 | 评论需验证码与速率限制防刷 |
| 登录作者 | 游客权限 + 后台登录、文章 CRUD、上传资源、评论管理（隐藏/删除）、查看统计 | 作者数量受限 |
| 管理员 | 作者权限 + 用户管理、系统配置、敏感操作日志 | 可选角色，默认仅站点拥有者 |

## 4. 功能模块划分
- **公共端**
  - 首页：最新文章、分组入口、推荐专题。
  - 分组/标签页：列表、筛选、搜索、分页。
  - 文章详情页：内容展示（Markdown/PDF）、目录、相关文章、评论区。
  - 关于页：作者信息、联系方式、社交链接。
  - 留言墙（可选）：独立评论流。
- **后台端**
  - 仪表盘：文章数量、阅读量、评论数趋势。
  - 文章管理：列表、筛选、批量操作、编辑器（Markdown/PDF 上传）、预览、发布流程。
  - 分组与标签管理：排序、可见性、描述。
  - 资源库：复用文件管理能力，展示封面/附件，支持分类与搜索。
  - 评论管理：查询、隐藏、删除、关键词过滤；游客评论默认直接展示，可通过后台隐藏。
  - 用户与配置：账号管理、站点信息、社交链接配置、SEO 元信息。

## 5. 信息架构与导航
- **公共导航**：`首页 / 归档 / 分组 / 关于 / 留言`。
- **文章详情路由**：`/posts/:slug`，根据 `content_type` 决定渲染模式。
- **后台导航**：左侧菜单 `仪表盘 / 文章 / 分组标签 / 资源库 / 评论 / 用户 / 设置`，顶部包含头像与退出。
- **面包屑设计**：详情页显示 `首页 > 分组 > 文章标题`。

## 6. 界面与视觉风格
- **色彩**：基础背景 `#F5F7FA`，主色 `#4C7AF2`，辅色 `#FFB84C`；文字使用高对比度深灰。
- **字体与排版**：中文苹方/思源黑体，标题 24-32px，正文 16px，行高 1.8；Markdown 区域保留足够留白。
- **卡片式布局**：文章列表使用阴影极浅的卡片，圆角 12px，交互采用细微缩放。
- **响应式**：移动端单列、隐藏不必要装饰；导航折叠为抽屉。
- **评论区**：采用气泡式条目，配合层级区分回复；游客评论提交后即时出现并标记“游客”。

## 7. 关键用户流程
1. **文章浏览**：访客进入首页 → 浏览精选列表 → 点击文章 → 阅读 → 查看推荐文章 → 评论或分享。
2. **作者发布**：作者登录后台 → 仪表盘 → 新建文章 → 选择 Markdown/PDF → 上传/编辑 → 配置分组标签 + 封面 → 发布 → 前台展示。
3. **游客评论（无需审核）**：访客在文章详情底部填写昵称+邮箱（可选）+内容 → 通过验证码 → 即时写入数据库并回显。
4. **作者管理评论**：后台评论列表 → 搜索/筛选 → 对不当评论执行隐藏或删除（即刻影响前台）。

## 8. 数据模型设计
### 8.1 表结构（建议）
- `users`: `id`, `username`, `password_hash`, `role`, `avatar_url`, `bio`, `created_at`, `updated_at`, `last_login_at`。
- `articles`: `id`, `title`, `slug`, `summary`, `content_type`(`md`/`pdf`), `content_url`, `cover_url`, `group_id`, `tags`(JSON), `status`, `publish_time`, `views`, `author_id`, `created_at`, `updated_at`。
- `groups`: `id`, `name`, `description`, `order_index`, `visible`, `cover_url`。
- `article_tag_rel`: `article_id`, `tag`（简化为字符串）。
- `comments`: `id`, `article_id`, `user_id`(可空), `nickname`, `email`, `content`, `parent_id`, `status`(`visible`/`hidden`), `ip`, `user_agent`, `created_at`。
- `assets`: `id`, `url`, `name`, `type`, `size`, `uploader_id`, `created_at`。
- `site_settings`: key-value 配置表。

### 8.2 缓存与统计
- Redis/数据库视图用于缓存热门文章、评论计数。
- 定时任务统计 PV/UV，写入 `article_daily_stats`。

## 9. API 设计（REST）
### 9.1 认证
- `POST /auth/login`: 用户名密码登录，返回 access/refresh token。
- `POST /auth/refresh`: 刷新 access token。
- `POST /auth/logout`: 使 refresh token 失效。

### 9.2 公共文章
- `GET /articles`: 参数 `page`, `size`, `group`, `tag`, `keyword`。
- `GET /articles/{slug}`: 返回详情、上一篇/下一篇摘要。
- `GET /articles/{id}/comments`: 支持分页、按创建时间排序。
- `POST /articles/{id}/comments`: 游客提交评论，无审核，成功即 `status=visible`。
- `GET /groups`: 返回分组与文章计数。

### 9.3 后台文章与资源
- `POST /admin/articles`: 创建（上传 Markdown 文件或 PDF，并保存 URL）。
- `PUT /admin/articles/{id}` / `PATCH`：更新信息、切换状态。
- `DELETE /admin/articles/{id}`: 删除或软删除。
- `POST /admin/articles/upload`: 复用现有 `/files/upload`，增加 `type=article`、`dir` 参数。
- `GET /admin/assets`: 列表，参数 `type`, `keyword`。
- `DELETE /admin/assets/{id}`。

### 9.4 评论管理
- `GET /admin/comments`: 筛选 `article_id`, `keyword`, `status`。
- `PATCH /admin/comments/{id}`: 更新 `status`（visible/hidden）。
- `DELETE /admin/comments/{id}`。

### 9.5 用户与设置
- `GET/POST/PATCH /admin/users`。
- `GET/PATCH /admin/settings`: 站点标题、描述、社交链接、评论开关、SEO。

## 10. 前端实现规划
### 10.1 路由结构
```
/
  ├─ /posts
  │   ├─ /posts/:slug
  │   └─ /posts/tag/:tag
  ├─ /groups/:groupId
  ├─ /archive
  ├─ /about
  ├─ /guestbook
  └─ /admin (布局包含登录守卫)
      ├─ dashboard
      ├─ articles
      │   ├─ list
      │   └─ edit/:id?
      ├─ groups
      ├─ assets
      ├─ comments
      ├─ users
      └─ settings
```

### 10.2 Pinia Store 划分
- `useAuthStore`: Token、当前用户、登录/刷新/注销逻辑。
- `useArticleStore`: 列表缓存、详情缓存、分页状态、阅读计数提交。
- `useGroupStore`: 分组/标签缓存、首页专题数据。
- `useCommentStore`: 按文章维护评论列表、节流提交状态。
- `useSettingStore`: 站点配置（标题、社交链接、评论开关）。

### 10.3 UI 组件
- 通用组件：`NavBar`, `Footer`, `ArticleCard`, `TagList`, `SearchBar`, `Pagination`, `CommentList`, `CommentForm`, `MarkdownViewer`, `PdfViewer`, `BackToTop`。
- 后台组件：`AdminLayout`, `SideMenu`, `StatCard`, `EditForm`, `UploadModal`, `ConfirmDialog`, `Table`, `FilterBar`。

### 10.4 文章内容渲染
- Markdown：预处理添加目录锚点、代码高亮、图片懒加载、数学公式（可选）。
- PDF：引入 `pdf.js` viewer 组件，支持分页导航、缩放、下载按钮。
- 文章详情页同时提供“阅读进度条”（滚动监听）。

### 10.5 评论实现
- 游客评论提交步骤：输入昵称（可空，默认“访客”）、邮箱（用于 Gravatar 可选）、内容 → reCAPTCHA/图形验证码 → API 提交 → 写入列表顶部。
- 防刷：前端节流（同 IP 15 秒内仅一次）、后端限流、敏感词过滤。
- 回复：支持二级回复结构（`parent_id`）。

### 10.6 国际化与 SEO
- 默认中文，可预留 i18n 架构（Vue I18n）。
- 使用 `<meta>`、`og` 标签、结构化数据增强 SEO；部署后配置站点地图、RSS。

## 11. 后端补充需求
- 增加文章、评论相关表与接口；PDF/Markdown 文件存储路径策略。
- 评论提交直接写入 `visible` 状态；提供隐藏接口用于作者处理不当内容。
- JWT 鉴权与刷新机制，后台接口需角色验证；游客评论无需登录。
- 统计信息接口：文章阅读量、每日评论数、热门文章榜。
- 日志审计：评论删除、文章发布等操作记录。

## 12. 安全与性能
- **鉴权**：前端 `axios` 请求头自动附加 `Authorization`；维护刷新 token 流程。
- **评论安全**：验证码、IP 速率限制、敏感词过滤、XSS 清洗（后端使用白名单或转义）。
- **上传安全**：校验 MIME/扩展名，限制大小，PDF 渲染前检查。
- **性能优化**：首屏骨架、组件懒加载、文章内容按需加载、图片压缩、自定义缓存策略。
- **备份**：文章内容与资产定期备份，可挂载对象存储。

## 13. 部署策略
- 环境变量：`VITE_API_BASE_URL`, `VITE_SITE_TITLE`, `VITE_RECAPTCHA_KEY` 等。
- 前端构建：CI 触发 `npm run build`，产物部署至静态服务器 (Nginx/CDN)。
- 后端部署：Node/Java/Kotlin 任一实现，提供 REST API；配置 HTTPS。
- CDN：文章封面与 PDF 可托管至对象存储 + CDN，减轻源站压力。
- 监控：接入日志系统、错误上报、访问监控。

## 14. 迭代计划
| 里程碑 | 主要交付 | 预计周期 |
| --- | --- | --- |
| M1 基础框架 | 引入 Router/Pinia、公共布局、首页静态版 | 1 周 |
| M2 文章系统 | 列表、详情、Markdown 渲染、PDF 预览、分组筛选 | 1-2 周 |
| M3 评论模块 | 评论 API、前端评论区、游客评论即时展示、防刷 | 1 周 |
| M4 后台文章管理 | 后台框架、文章 CRUD、文件上传 | 2 周 |
| M5 配置与优化 | 站点设置、用户管理、SEO、性能优化 | 1 周 |
| M6 部署与验收 | CI/CD、生产环境部署、监控 | 0.5-1 周 |

## 15. 测试策略
- **单元测试**：重点覆盖 Pinia store、工具函数（文件类型检测、格式化函数）。
- **组件测试**：使用 Vue Test Utils + Vitest 验证评论表单、Markdown 渲染组件。
- **端到端测试**：Cypress 覆盖关键流程：文章浏览、搜索、评论提交、后台发布。
- **性能与安全测试**：Lighthouse 性能评估、OWASP ZAP 简易扫描、上传与评论接口压力测试。

## 16. 扩展方向
- 夜间模式、阅读模式；
- RSS 输出、站点地图自动更新；
- Webhook/社交推送；
- AI 辅助写作或摘要；
- 统计仪表盘增强（热门标签、阅读路径分析）。

---
本文档可作为后续需求细化、任务拆解与评审的基础。如需原型图或接口 Swagger 示例，可在此方案基础上继续拓展。

