# 清爽简易风格个人博客方案

## 1. 项目背景与目标
- **背景**：基于现有 `Vue 3 + Vite` 前端项目扩展为个人博客站点，继续复用现有 Axios 封装及文件上传能力。
- **目标**：提供公众阅读文章、自由评论、按分组浏览以及作者后台维护文章的完整闭环，保持界面简洁清爽。
- **关键诉求**：
  - 文章支持 Markdown 与 PDF 两种格式。
  - 文章可配置分组与标签，访客能够快捷筛选。
  - 每篇文章跳转详情页阅读，并在底部开放游客评论（无需后台审核）。
  - 作者后台可上传、编辑、发布文章以及维护评论与站点信息。

## 2. 技术栈与依赖
- **核心框架**：Vue 3（`<script setup>`）、Vite。
- **状态管理**：Pinia（替换/扩展现有局部状态）。
- **路由管理**：Vue Router 4。
- **UI & 样式**：CSS 变量 + Tailwind Lite 或自定义原子类，保持轻量；可引入 `postcss` 进行变量处理。
- **Markdown 渲染**：`markdown-it` + `markdown-it-anchor` + `highlight.js`。
- **PDF 预览**：`pdfjs-dist`（内嵌 viewer）或轻量第三方组件。
- **评论编辑**：原生 `<textarea>` + `@vueuse/core` 辅助节流。
- **表单与校验**：`vee-validate` 或自定义组合式校验逻辑。
- **HTTP**：沿用 `axios` 封装（`src/api/request.js`）。
- **构建与部署**：Vite 构建、Nginx/静态托管。

## 3. 系统角色与权限
| 角色 | 权限 | 说明 |
| --- | --- | --- |
| 游客 | 浏览文章、搜索、按分组/标签过滤、提交评论（即时展示）、编辑/删除自己未登录状态下的评论限时 15 分钟 | 评论需验证码与速率限制防刷 |
| 登录作者 | 游客权限 + 后台登录、文章 CRUD、上传资源、评论管理（隐藏/删除）、查看统计 | 作者数量受限 |
| 管理员 | 作者权限 + 用户管理、系统配置、敏感操作日志 | 可选角色，默认仅站点拥有者 |

## 4. 功能模块划分
- **公共端**
  - 首页：最新文章、分组入口、推荐专题。
  - 分组/标签页：列表、筛选、搜索、分页。
  - 文章详情页：内容展示（Markdown/PDF）、目录、相关文章、评论区。
  - 关于页：作者信息、联系方式、社交链接。
  - 留言墙（可选）：独立评论流。
- **后台端**
  - 仪表盘：文章数量、阅读量、评论数趋势。
  - 文章管理：列表、筛选、批量操作、编辑器（Markdown/PDF 上传）、预览、发布流程。
  - 分组与标签管理：排序、可见性、描述。
  - 资源库：复用文件管理能力，展示封面/附件，支持分类与搜索。
  - 评论管理：查询、隐藏、删除、关键词过滤；游客评论默认直接展示，可通过后台隐藏。
  - 用户与配置：账号管理、站点信息、社交链接配置、SEO 元信息。

## 5. 信息架构与导航
- **公共导航**：`首页 / 归档 / 分组 / 关于 / 留言`。
- **文章详情路由**：`/posts/:slug`，根据 `content_type` 决定渲染模式。
- **后台导航**：左侧菜单 `仪表盘 / 文章 / 分组标签 / 资源库 / 评论 / 用户 / 设置`，顶部包含头像与退出。
- **面包屑设计**：详情页显示 `首页 > 分组 > 文章标题`。

## 6. 界面与视觉风格
- **色彩**：基础背景 `#F5F7FA`，主色 `#4C7AF2`，辅色 `#FFB84C`；文字使用高对比度深灰。
- **字体与排版**：中文苹方/思源黑体，标题 24-32px，正文 16px，行高 1.8；Markdown 区域保留足够留白。
- **卡片式布局**：文章列表使用阴影极浅的卡片，圆角 12px，交互采用细微缩放。
- **响应式**：移动端单列、隐藏不必要装饰；导航折叠为抽屉。
- **评论区**：采用气泡式条目，配合层级区分回复；游客评论提交后即时出现并标记“游客”。

## 7. 关键用户流程
1. **文章浏览**：访客进入首页 → 浏览精选列表 → 点击文章 → 阅读 → 查看推荐文章 → 评论或分享。
2. **作者发布**：作者登录后台 → 仪表盘 → 新建文章 → 选择 Markdown/PDF → 上传/编辑 → 配置分组标签 + 封面 → 发布 → 前台展示。
3. **游客评论（无需审核）**：访客在文章详情底部填写昵称+邮箱（可选）+内容 → 通过验证码 → 即时写入数据库并回显。
4. **作者管理评论**：后台评论列表 → 搜索/筛选 → 对不当评论执行隐藏或删除（即刻影响前台）。

## 8. 数据模型设计
### 8.1 表结构（建议）
- `users`: `id`, `username`, `password_hash`, `role`, `avatar_url`, `bio`, `created_at`, `updated_at`, `last_login_at`。
- `articles`: `id`, `title`, `slug`, `summary`, `content_type`(`md`/`pdf`), `content_url`, `cover_url`, `group_id`, `tags`(JSON), `status`, `publish_time`, `views`, `author_id`, `created_at`, `updated_at`。
- `groups`: `id`, `name`, `description`, `order_index`, `visible`, `cover_url`。
- `article_tag_rel`: `article_id`, `tag`（简化为字符串）。
- `comments`: `id`, `article_id`, `user_id`(可空), `nickname`, `email`, `content`, `parent_id`, `status`(`visible`/`hidden`), `ip`, `user_agent`, `created_at`。
- `assets`: `id`, `url`, `name`, `type`, `size`, `uploader_id`, `created_at`。
- `site_settings`: key-value 配置表。

### 8.2 缓存与统计
- Redis/数据库视图用于缓存热门文章、评论计数。
- 定时任务统计 PV/UV，写入 `article_daily_stats`。

## 9. API 设计（REST）
### 9.1 认证接口
| 接口 | 方法 | 说明 | 鉴权 |
| --- | --- | --- | --- |
| `/api/auth/login` | POST | 用户名密码登录 | 否 |
| `/api/auth/refresh` | POST | 刷新 access token | 否 |
| `/api/auth/logout` | POST | 注销登录 | 是 |

**示例 - 登录接口**：
```json
// Request
POST /api/auth/login
{
  "username": "admin",
  "password": "password123"
}

// Response
{
  "code": 200,
  "message": "登录成功",
  "data": {
    "accessToken": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
    "refreshToken": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
    "expiresIn": 900,
    "user": {
      "id": 1,
      "username": "admin",
      "role": "admin",
      "avatar": "https://example.com/avatar.jpg"
    }
  }
}
```

### 9.2 公共文章接口
| 接口 | 方法 | 说明 | 鉴权 |
| --- | --- | --- | --- |
| `/api/articles` | GET | 文章列表（分页、筛选、搜索） | 否 |
| `/api/articles/{slug}` | GET | 文章详情 | 否 |
| `/api/articles/hot` | GET | 热门文章 | 否 |
| `/api/articles/{id}/related` | GET | 相关文章推荐 | 否 |

**示例 - 文章列表接口**：
```json
// Request
GET /api/articles?page=1&size=10&group=tech&tag=Java&keyword=Spring&status=published&sort=publish_time

// Response
{
  "code": 200,
  "message": "success",
  "data": {
    "total": 100,
    "page": 1,
    "size": 10,
    "items": [
      {
        "id": 1,
        "title": "Spring Boot 最佳实践",
        "slug": "spring-boot-best-practices",
        "summary": "本文介绍 Spring Boot 开发中的最佳实践...",
        "coverUrl": "https://example.com/cover.jpg",
        "contentType": "markdown",
        "groupId": 1,
        "groupName": "技术分享",
        "tags": ["Java", "Spring Boot"],
        "status": "published",
        "publishTime": "2025-01-15T10:30:00",
        "views": 1234,
        "commentCount": 56,
        "author": {
          "id": 1,
          "username": "admin",
          "avatar": "https://example.com/avatar.jpg"
        },
        "createdAt": "2025-01-15T09:00:00",
        "updatedAt": "2025-01-15T10:30:00"
      }
    ]
  }
}
```

**示例 - 文章详情接口**：
```json
// Request
GET /api/articles/spring-boot-best-practices

// Response
{
  "code": 200,
  "message": "success",
  "data": {
    "id": 1,
    "title": "Spring Boot 最佳实践",
    "slug": "spring-boot-best-practices",
    "summary": "本文介绍 Spring Boot 开发中的最佳实践...",
    "contentType": "markdown",
    "contentText": "# Spring Boot 最佳实践\n\n## 1. 项目结构...",
    "contentUrl": null,
    "coverUrl": "https://example.com/cover.jpg",
    "groupId": 1,
    "groupName": "技术分享",
    "tags": [
      { "id": 1, "name": "Java", "color": "#E57373" },
      { "id": 2, "name": "Spring Boot", "color": "#64B5F6" }
    ],
    "status": "published",
    "publishTime": "2025-01-15T10:30:00",
    "views": 1234,
    "commentCount": 56,
    "allowComment": true,
    "author": {
      "id": 1,
      "username": "admin",
      "bio": "全栈开发工程师",
      "avatar": "https://example.com/avatar.jpg"
    },
    "prevArticle": {
      "id": 2,
      "title": "上一篇文章",
      "slug": "prev-article"
    },
    "nextArticle": {
      "id": 3,
      "title": "下一篇文章",
      "slug": "next-article"
    },
    "createdAt": "2025-01-15T09:00:00",
    "updatedAt": "2025-01-15T10:30:00"
  }
}
```

### 9.3 评论接口
| 接口 | 方法 | 说明 | 鉴权 |
| --- | --- | --- | --- |
| `/api/articles/{id}/comments` | GET | 获取文章评论列表 | 否 |
| `/api/articles/{id}/comments` | POST | 提交评论（游客/用户） | 否 |
| `/api/comments/{id}` | DELETE | 删除自己的评论（游客15分钟内） | 否 |

**示例 - 提交评论接口**：
```json
// Request
POST /api/articles/1/comments
{
  "nickname": "访客",
  "email": "visitor@example.com",
  "website": "https://example.com",
  "content": "写得很好，受益匪浅！",
  "parentId": null,
  "replyToId": null,
  "captcha": "abc123"
}

// Response
{
  "code": 200,
  "message": "评论成功",
  "data": {
    "id": 100,
    "articleId": 1,
    "nickname": "访客",
    "email": "visitor@example.com",
    "website": "https://example.com",
    "content": "写得很好，受益匪浅！",
    "avatar": "https://www.gravatar.com/avatar/xxx",
    "parentId": null,
    "replyToId": null,
    "status": "visible",
    "createdAt": "2025-01-16T14:30:00",
    "canDelete": true,
    "deleteToken": "temp-token-for-15min"
  }
}
```

### 9.4 分组与标签接口
| 接口 | 方法 | 说明 | 鉴权 |
| --- | --- | --- | --- |
| `/api/groups` | GET | 分组列表（含文章数） | 否 |
| `/api/tags` | GET | 标签列表（含文章数） | 否 |
| `/api/tags/hot` | GET | 热门标签 | 否 |

### 9.5 后台文章管理接口
| 接口 | 方法 | 说明 | 鉴权 |
| --- | --- | --- | --- |
| `/api/admin/articles` | GET | 文章列表（含草稿） | 是 |
| `/api/admin/articles` | POST | 创建文章 | 是 |
| `/api/admin/articles/{id}` | GET | 文章详情 | 是 |
| `/api/admin/articles/{id}` | PUT | 更新文章 | 是 |
| `/api/admin/articles/{id}` | DELETE | 删除文章 | 是 |
| `/api/admin/articles/{id}/publish` | POST | 发布文章 | 是 |
| `/api/admin/articles/{id}/archive` | POST | 归档文章 | 是 |
| `/api/admin/articles/batch-delete` | POST | 批量删除 | 是 |

**示例 - 创建文章接口**：
```json
// Request
POST /api/admin/articles
{
  "title": "新文章标题",
  "slug": "new-article-slug",  // 可选，不填自动生成
  "summary": "文章摘要...",
  "contentType": "markdown",
  "contentText": "# 文章内容\n\n...",
  "coverUrl": "https://example.com/cover.jpg",
  "groupId": 1,
  "tagIds": [1, 2, 3],
  "status": "draft",
  "allowComment": true,
  "isTop": false
}

// Response
{
  "code": 200,
  "message": "创建成功",
  "data": {
    "id": 101,
    "slug": "new-article-slug"
  }
}
```

### 9.6 后台评论管理接口
| 接口 | 方法 | 说明 | 鉴权 |
| --- | --- | --- | --- |
| `/api/admin/comments` | GET | 评论列表（全部） | 是 |
| `/api/admin/comments/{id}` | PATCH | 更新评论状态 | 是 |
| `/api/admin/comments/{id}` | DELETE | 删除评论 | 是 |
| `/api/admin/comments/batch-hide` | POST | 批量隐藏 | 是 |
| `/api/admin/comments/batch-delete` | POST | 批量删除 | 是 |

### 9.7 后台分组标签管理
| 接口 | 方法 | 说明 | 鉴权 |
| --- | --- | --- | --- |
| `/api/admin/groups` | GET | 分组列表 | 是 |
| `/api/admin/groups` | POST | 创建分组 | 是 |
| `/api/admin/groups/{id}` | PUT | 更新分组 | 是 |
| `/api/admin/groups/{id}` | DELETE | 删除分组 | 是 |
| `/api/admin/tags` | GET | 标签列表 | 是 |
| `/api/admin/tags` | POST | 创建标签 | 是 |
| `/api/admin/tags/{id}` | PUT | 更新标签 | 是 |
| `/api/admin/tags/{id}` | DELETE | 删除标签 | 是 |

### 9.8 后台统计与配置
| 接口 | 方法 | 说明 | 鉴权 |
| --- | --- | --- | --- |
| `/api/admin/dashboard/stats` | GET | 仪表盘统计数据 | 是 |
| `/api/admin/settings` | GET | 获取站点配置 | 是 |
| `/api/admin/settings` | PUT | 更新站点配置 | 是 |
| `/api/admin/users` | GET | 用户列表 | 是 |
| `/api/admin/users/{id}` | PATCH | 更新用户信息 | 是 |

**示例 - 仪表盘统计接口**：
```json
// Response
{
  "code": 200,
  "data": {
    "articleStats": {
      "total": 150,
      "published": 120,
      "draft": 30,
      "thisMonthNew": 15
    },
    "commentStats": {
      "total": 2340,
      "thisMonthNew": 180,
      "pending": 0
    },
    "viewStats": {
      "total": 125678,
      "today": 567,
      "thisWeek": 3456
    },
    "hotArticles": [
      {
        "id": 1,
        "title": "最热文章",
        "views": 5678,
        "comments": 123
      }
    ],
    "recentComments": [],
    "viewTrend": [
      { "date": "2025-01-10", "views": 456 },
      { "date": "2025-01-11", "views": 523 }
    ]
  }
}
```

## 10. 前端实现规划
### 10.1 路由结构
```
/
  ├─ /posts
  │   ├─ /posts/:slug
  │   └─ /posts/tag/:tag
  ├─ /groups/:groupId
  ├─ /archive
  ├─ /about
  ├─ /guestbook
  └─ /admin (布局包含登录守卫)
      ├─ dashboard
      ├─ articles
      │   ├─ list
      │   └─ edit/:id?
      ├─ groups
      ├─ assets
      ├─ comments
      ├─ users
      └─ settings
```

### 10.2 Pinia Store 划分
- `useAuthStore`: Token、当前用户、登录/刷新/注销逻辑。
- `useArticleStore`: 列表缓存、详情缓存、分页状态、阅读计数提交。
- `useGroupStore`: 分组/标签缓存、首页专题数据。
- `useCommentStore`: 按文章维护评论列表、节流提交状态。
- `useSettingStore`: 站点配置（标题、社交链接、评论开关）。

### 10.3 UI 组件
- 通用组件：`NavBar`, `Footer`, `ArticleCard`, `TagList`, `SearchBar`, `Pagination`, `CommentList`, `CommentForm`, `MarkdownViewer`, `PdfViewer`, `BackToTop`。
- 后台组件：`AdminLayout`, `SideMenu`, `StatCard`, `EditForm`, `UploadModal`, `ConfirmDialog`, `Table`, `FilterBar`。

### 10.4 文章内容渲染
- Markdown：预处理添加目录锚点、代码高亮、图片懒加载、数学公式（可选）。
- PDF：引入 `pdf.js` viewer 组件，支持分页导航、缩放、下载按钮。
- 文章详情页同时提供“阅读进度条”（滚动监听）。

### 10.5 评论实现
- 游客评论提交步骤：输入昵称（可空，默认“访客”）、邮箱（用于 Gravatar 可选）、内容 → reCAPTCHA/图形验证码 → API 提交 → 写入列表顶部。
- 防刷：前端节流（同 IP 15 秒内仅一次）、后端限流、敏感词过滤。
- 回复：支持二级回复结构（`parent_id`）。

### 10.6 国际化与 SEO
- 默认中文，可预留 i18n 架构（Vue I18n）。
- 使用 `<meta>`、`og` 标签、结构化数据增强 SEO；部署后配置站点地图、RSS。

## 11. 后端实现规划（基于 module-home 模块）

### 11.1 模块位置与架构
- **实现位置**：`module-home` 模块，与 `module-file` 平级，复用 `common` 模块的配置和工具类。
- **技术栈**：Spring Boot 3.x + Kotlin + MyBatis Plus + Redis + MySQL/PostgreSQL。
- **依赖复用**：
  - 复用 `common` 模块：`CorsConfig`, `MyBatisPlusConfig`, `RedisConfig`, `ApiResponse`, `GlobalExceptionHandler`, `RedisUtil`。
  - 集成 `module-file` 模块：文章封面、PDF 文件、Markdown 文件通过文件模块上传和管理。

### 11.2 包结构设计
```
module-home/
└── src/main/kotlin/com/zzy/home/
    ├── controller/          # 控制器层
    │   ├── ArticleController.kt      # 文章公共接口
    │   ├── ArticleAdminController.kt # 文章管理接口
    │   ├── GroupController.kt        # 分组管理
    │   ├── CommentController.kt      # 评论公共接口
    │   ├── CommentAdminController.kt # 评论管理接口
    │   └── SettingController.kt      # 站点配置
    ├── service/            # 业务逻辑层
    │   ├── ArticleService.kt
    │   ├── GroupService.kt
    │   ├── TagService.kt
    │   ├── CommentService.kt
    │   ├── UserService.kt
    │   └── SettingService.kt
    ├── mapper/             # 数据访问层
    │   ├── ArticleMapper.kt
    │   ├── GroupMapper.kt
    │   ├── TagMapper.kt
    │   ├── CommentMapper.kt
    │   ├── UserMapper.kt
    │   └── SettingMapper.kt
    ├── entity/             # 实体类
    │   ├── Article.kt
    │   ├── Group.kt
    │   ├── Tag.kt
    │   ├── ArticleTagRel.kt
    │   ├── Comment.kt
    │   ├── User.kt
    │   └── SiteSetting.kt
    ├── dto/                # 数据传输对象
    │   ├── request/
    │   │   ├── ArticleCreateRequest.kt
    │   │   ├── ArticleUpdateRequest.kt
    │   │   ├── ArticleQueryRequest.kt
    │   │   ├── CommentCreateRequest.kt
    │   │   └── CommentQueryRequest.kt
    │   └── response/
    │       ├── ArticleListResponse.kt
    │       ├── ArticleDetailResponse.kt
    │       ├── GroupResponse.kt
    │       ├── CommentResponse.kt
    │       └── DashboardStatsResponse.kt
    ├── enums/              # 枚举类
    │   ├── ContentType.kt        # Markdown/PDF
    │   ├── ArticleStatus.kt      # draft/published/archived
    │   ├── CommentStatus.kt      # visible/hidden
    │   └── UserRole.kt           # guest/author/admin
    ├── config/             # 模块配置
    │   ├── SecurityConfig.kt     # JWT鉴权配置
    │   └── BlogProperties.kt     # 博客模块配置
    ├── interceptor/        # 拦截器
    │   ├── AuthInterceptor.kt    # 认证拦截
    │   └── RateLimitInterceptor.kt # 评论防刷
    ├── util/               # 工具类
    │   ├── JwtUtil.kt            # JWT工具
    │   ├── SlugUtil.kt           # URL友好slug生成
    │   ├── MarkdownUtil.kt       # Markdown处理
    │   └── SensitiveWordFilter.kt # 敏感词过滤
    └── exception/          # 异常类
        ├── ArticleNotFoundException.kt
        ├── UnauthorizedException.kt
        └── RateLimitException.kt
```

### 11.3 数据库表设计（完善版）
```sql
-- 用户表
CREATE TABLE blog_users (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    username VARCHAR(50) NOT NULL UNIQUE COMMENT '用户名',
    password_hash VARCHAR(255) NOT NULL COMMENT '密码哈希',
    role VARCHAR(20) NOT NULL DEFAULT 'author' COMMENT '角色: guest/author/admin',
    avatar_url VARCHAR(500) COMMENT '头像URL',
    bio TEXT COMMENT '个人简介',
    email VARCHAR(100) COMMENT '邮箱',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    last_login_at TIMESTAMP NULL,
    INDEX idx_username (username),
    INDEX idx_role (role)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='博客用户表';

-- 文章分组表
CREATE TABLE blog_groups (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    name VARCHAR(100) NOT NULL UNIQUE COMMENT '分组名称',
    slug VARCHAR(100) NOT NULL UNIQUE COMMENT 'URL slug',
    description TEXT COMMENT '分组描述',
    cover_url VARCHAR(500) COMMENT '封面图',
    order_index INT DEFAULT 0 COMMENT '排序序号',
    visible TINYINT(1) DEFAULT 1 COMMENT '是否可见',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    INDEX idx_order (order_index),
    INDEX idx_visible (visible)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='文章分组表';

-- 标签表
CREATE TABLE blog_tags (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    name VARCHAR(50) NOT NULL UNIQUE COMMENT '标签名',
    color VARCHAR(20) COMMENT '标签颜色',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    INDEX idx_name (name)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='标签表';

-- 文章表
CREATE TABLE blog_articles (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    title VARCHAR(200) NOT NULL COMMENT '文章标题',
    slug VARCHAR(200) NOT NULL UNIQUE COMMENT 'URL slug',
    summary TEXT COMMENT '摘要',
    content_type VARCHAR(20) NOT NULL COMMENT '内容类型: markdown/pdf',
    content_text LONGTEXT COMMENT 'Markdown原始内容',
    content_url VARCHAR(500) COMMENT 'PDF文件URL',
    cover_url VARCHAR(500) COMMENT '封面图URL',
    group_id BIGINT COMMENT '所属分组',
    status VARCHAR(20) NOT NULL DEFAULT 'draft' COMMENT '状态: draft/published/archived',
    publish_time TIMESTAMP NULL COMMENT '发布时间',
    views BIGINT DEFAULT 0 COMMENT '浏览量',
    comment_count INT DEFAULT 0 COMMENT '评论数',
    author_id BIGINT NOT NULL COMMENT '作者ID',
    allow_comment TINYINT(1) DEFAULT 1 COMMENT '是否允许评论',
    is_top TINYINT(1) DEFAULT 0 COMMENT '是否置顶',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    deleted_at TIMESTAMP NULL COMMENT '软删除时间',
    FOREIGN KEY (author_id) REFERENCES blog_users(id),
    FOREIGN KEY (group_id) REFERENCES blog_groups(id) ON DELETE SET NULL,
    INDEX idx_slug (slug),
    INDEX idx_status (status),
    INDEX idx_publish_time (publish_time),
    INDEX idx_group (group_id),
    INDEX idx_author (author_id),
    INDEX idx_views (views),
    INDEX idx_deleted (deleted_at),
    FULLTEXT idx_title_summary (title, summary)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='文章表';

-- 文章标签关联表
CREATE TABLE blog_article_tag_rel (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    article_id BIGINT NOT NULL,
    tag_id BIGINT NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (article_id) REFERENCES blog_articles(id) ON DELETE CASCADE,
    FOREIGN KEY (tag_id) REFERENCES blog_tags(id) ON DELETE CASCADE,
    UNIQUE KEY uk_article_tag (article_id, tag_id),
    INDEX idx_article (article_id),
    INDEX idx_tag (tag_id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='文章标签关联表';

-- 评论表
CREATE TABLE blog_comments (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    article_id BIGINT NOT NULL COMMENT '文章ID',
    user_id BIGINT NULL COMMENT '用户ID(登录用户)',
    nickname VARCHAR(50) NOT NULL DEFAULT '访客' COMMENT '昵称',
    email VARCHAR(100) COMMENT '邮箱',
    website VARCHAR(200) COMMENT '个人网站',
    content TEXT NOT NULL COMMENT '评论内容',
    parent_id BIGINT NULL COMMENT '父评论ID',
    reply_to_id BIGINT NULL COMMENT '回复目标评论ID',
    reply_to_nickname VARCHAR(50) COMMENT '回复目标昵称',
    status VARCHAR(20) NOT NULL DEFAULT 'visible' COMMENT '状态: visible/hidden',
    ip VARCHAR(50) COMMENT 'IP地址',
    user_agent VARCHAR(500) COMMENT '用户代理',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (article_id) REFERENCES blog_articles(id) ON DELETE CASCADE,
    FOREIGN KEY (user_id) REFERENCES blog_users(id) ON DELETE SET NULL,
    FOREIGN KEY (parent_id) REFERENCES blog_comments(id) ON DELETE CASCADE,
    INDEX idx_article (article_id),
    INDEX idx_user (user_id),
    INDEX idx_parent (parent_id),
    INDEX idx_status (status),
    INDEX idx_created (created_at)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='评论表';

-- 站点配置表
CREATE TABLE blog_site_settings (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    setting_key VARCHAR(100) NOT NULL UNIQUE COMMENT '配置键',
    setting_value TEXT COMMENT '配置值',
    setting_type VARCHAR(20) DEFAULT 'string' COMMENT '值类型: string/number/boolean/json',
    description VARCHAR(200) COMMENT '描述',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    INDEX idx_key (setting_key)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='站点配置表';

-- 文章统计表（可选）
CREATE TABLE blog_article_stats (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    article_id BIGINT NOT NULL,
    stat_date DATE NOT NULL COMMENT '统计日期',
    views INT DEFAULT 0 COMMENT '浏览量',
    comments INT DEFAULT 0 COMMENT '评论数',
    FOREIGN KEY (article_id) REFERENCES blog_articles(id) ON DELETE CASCADE,
    UNIQUE KEY uk_article_date (article_id, stat_date),
    INDEX idx_date (stat_date)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='文章统计表';

-- 操作日志表（可选）
CREATE TABLE blog_audit_logs (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    user_id BIGINT NOT NULL,
    action VARCHAR(50) NOT NULL COMMENT '操作类型',
    resource_type VARCHAR(50) COMMENT '资源类型',
    resource_id BIGINT COMMENT '资源ID',
    details TEXT COMMENT '操作详情JSON',
    ip VARCHAR(50),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES blog_users(id),
    INDEX idx_user (user_id),
    INDEX idx_action (action),
    INDEX idx_created (created_at)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='操作日志表';
```

### 11.4 核心功能实现要点
- **文章管理**：
  - Markdown 文章：存储原文到 `content_text` 字段，前端渲染。
  - PDF 文章：通过 `module-file` 上传，存储 URL 到 `content_url`。
  - Slug 自动生成：使用拼音或自定义，确保唯一性。
  - 软删除：使用 `deleted_at` 字段。
  
- **评论系统**：
  - 游客评论：无需登录，直接写入 `status=visible`。
  - 防刷机制：Redis 记录 IP + 文章ID，15秒内限制提交。
  - 敏感词过滤：建立敏感词库，评论提交时检测。
  - 层级结构：支持二级回复（`parent_id` + `reply_to_id`）。

- **JWT 鉴权**：
  - Access Token (15分钟) + Refresh Token (7天)。
  - 后台接口通过 `AuthInterceptor` 验证 token 和角色。
  - 游客评论接口无需验证。

- **统计功能**：
  - 阅读量：文章详情接口调用时异步 +1，使用 Redis 缓存避免频繁写库。
  - 评论数：评论新增/删除时更新 `blog_articles.comment_count`。
  - 热门文章：Redis ZSet 维护浏览量排行。

- **缓存策略**：
  - 文章列表：Redis 缓存 5 分钟。
  - 文章详情：Redis 缓存 10 分钟，更新/删除时主动清除。
  - 热门文章、分组列表：Redis 缓存 30 分钟。

### 11.5 依赖配置（module-home/pom.xml）
```xml
<dependencies>
    <!-- 依赖 common 模块 -->
    <dependency>
        <groupId>com.zzy</groupId>
        <artifactId>common</artifactId>
        <version>${project.version}</version>
    </dependency>
    
    <!-- JWT -->
    <dependency>
        <groupId>io.jsonwebtoken</groupId>
        <artifactId>jjwt-api</artifactId>
        <version>0.11.5</version>
    </dependency>
    <dependency>
        <groupId>io.jsonwebtoken</groupId>
        <artifactId>jjwt-impl</artifactId>
        <version>0.11.5</version>
        <scope>runtime</scope>
    </dependency>
    <dependency>
        <groupId>io.jsonwebtoken</groupId>
        <artifactId>jjwt-jackson</artifactId>
        <version>0.11.5</version>
        <scope>runtime</scope>
    </dependency>
    
    <!-- Markdown 解析（可选，前端渲染则不需要） -->
    <dependency>
        <groupId>com.vladsch.flexmark</groupId>
        <artifactId>flexmark-all</artifactId>
        <version>0.64.8</version>
    </dependency>
    
    <!-- 拼音工具（slug生成） -->
    <dependency>
        <groupId>com.github.stuxuhai</groupId>
        <artifactId>jpinyin</artifactId>
        <version>1.1.8</version>
    </dependency>
</dependencies>
```

### 11.6 集成要点
- **与 module-file 集成**：
  - 文章封面、PDF 文件通过 `/files/upload` 接口上传。
  - 返回的 `fileId` 和 `url` 存储到文章表。
  - 文章删除时，可选择同步删除关联文件。

- **与 common 模块集成**：
  - 统一使用 `ApiResponse` 包装响应。
  - 复用 `GlobalExceptionHandler` 处理异常。
  - 使用 `RedisUtil` 操作缓存。
  - 沿用 `CorsConfig` 配置跨域。

- **配置文件**：在 `application.properties` 中增加博客模块配置：
  ```properties
  # 博客模块配置
  blog.jwt.secret=your-secret-key
  blog.jwt.access-token-expiration=900000
  blog.jwt.refresh-token-expiration=604800000
  blog.comment.rate-limit-seconds=15
  blog.article.cache-minutes=10
  ```

## 12. 安全与性能
- **鉴权**：前端 `axios` 请求头自动附加 `Authorization`；维护刷新 token 流程。
- **评论安全**：验证码、IP 速率限制、敏感词过滤、XSS 清洗（后端使用白名单或转义）。
- **上传安全**：校验 MIME/扩展名，限制大小，PDF 渲染前检查。
- **性能优化**：首屏骨架、组件懒加载、文章内容按需加载、图片压缩、自定义缓存策略。
- **备份**：文章内容与资产定期备份，可挂载对象存储。

## 13. 部署策略
- 环境变量：`VITE_API_BASE_URL`, `VITE_SITE_TITLE`, `VITE_RECAPTCHA_KEY` 等。
- 前端构建：CI 触发 `npm run build`，产物部署至静态服务器 (Nginx/CDN)。
- 后端部署：Node/Java/Kotlin 任一实现，提供 REST API；配置 HTTPS。
- CDN：文章封面与 PDF 可托管至对象存储 + CDN，减轻源站压力。
- 监控：接入日志系统、错误上报、访问监控。

## 14. 开发实施路线图

### 14.1 后端实施步骤（module-home）
| 阶段 | 任务 | 产出 | 预计工时 |
| --- | --- | --- | --- |
| **阶段 1：基础搭建** | 1. 创建 module-home 模块结构<br>2. 配置 pom.xml 依赖<br>3. 创建数据库表结构<br>4. 配置 MyBatis Plus<br>5. 编写枚举类和实体类 | 项目骨架、数据库 schema、实体类 | 1-2 天 |
| **阶段 2：认证鉴权** | 1. 实现 JWT 工具类<br>2. 编写 AuthInterceptor<br>3. 实现登录/刷新/登出接口<br>4. 测试 token 验证流程 | 认证系统完成 | 1-2 天 |
| **阶段 3：文章核心功能** | 1. ArticleMapper/Service/Controller<br>2. 文章 CRUD 接口<br>3. Slug 生成工具<br>4. 文章列表查询（分页、筛选）<br>5. 文章详情接口<br>6. 集成 module-file 上传 | 文章管理完成 | 2-3 天 |
| **阶段 4：分组标签** | 1. GroupMapper/Service/Controller<br>2. TagMapper/Service/Controller<br>3. 文章-标签关联管理<br>4. 分组标签 CRUD 接口 | 分类系统完成 | 1 天 |
| **阶段 5：评论系统** | 1. CommentMapper/Service/Controller<br>2. 游客评论接口<br>3. 评论列表（树形结构）<br>4. RateLimitInterceptor 防刷<br>5. 敏感词过滤工具 | 评论功能完成 | 2 天 |
| **阶段 6：统计与缓存** | 1. Redis 缓存层实现<br>2. 阅读量统计<br>3. 热门文章排行<br>4. 仪表盘统计接口<br>5. 定时任务（统计入库） | 统计系统完成 | 1-2 天 |
| **阶段 7：后台管理** | 1. 后台文章管理接口<br>2. 后台评论管理接口<br>3. 后台配置管理<br>4. 操作日志记录 | 后台管理完成 | 2 天 |
| **阶段 8：测试与优化** | 1. 单元测试覆盖<br>2. 接口测试（Postman/Swagger）<br>3. 性能优化<br>4. 异常处理完善 | 测试报告、优化文档 | 2 天 |

**后端总计**：约 12-15 工作日

### 14.2 前端实施步骤（Vue 3）
| 阶段 | 任务 | 产出 | 预计工时 |
| --- | --- | --- | --- |
| **阶段 1：基础框架** | 1. 安装依赖（Router/Pinia/Markdown-it 等）<br>2. 配置路由结构<br>3. 创建 Pinia store<br>4. 搭建公共布局<br>5. 响应式导航栏与页脚 | 项目框架 | 1-2 天 |
| **阶段 2：文章展示** | 1. 首页组件（文章列表）<br>2. 文章详情页<br>3. Markdown 渲染组件<br>4. PDF 预览组件<br>5. 文章卡片组件<br>6. 分页组件 | 文章浏览功能 | 2-3 天 |
| **阶段 3：分组筛选** | 1. 分组页面<br>2. 标签页面<br>3. 搜索功能<br>4. 筛选器组件<br>5. 归档页面 | 分类浏览功能 | 1-2 天 |
| **阶段 4：评论系统** | 1. 评论列表组件<br>2. 评论表单组件<br>3. 评论提交逻辑<br>4. 验证码集成<br>5. 评论回复功能 | 评论功能 | 2 天 |
| **阶段 5：后台框架** | 1. 后台布局<br>2. 登录页面<br>3. 仪表盘<br>4. 侧边栏菜单<br>5. 路由守卫 | 后台框架 | 1-2 天 |
| **阶段 6：后台文章管理** | 1. 文章列表页<br>2. 文章编辑器<br>3. 文件上传集成<br>4. 分组标签选择器<br>5. 文章预览 | 后台文章管理 | 2-3 天 |
| **阶段 7：后台其他管理** | 1. 评论管理页<br>2. 分组标签管理<br>3. 站点配置页<br>4. 资源库页面 | 后台完整功能 | 2 天 |
| **阶段 8：优化与美化** | 1. 样式优化<br>2. 动画效果<br>3. 骨架屏<br>4. 图片懒加载<br>5. SEO 优化 | 完善体验 | 2 天 |
| **阶段 9：测试与修复** | 1. 功能测试<br>2. 兼容性测试<br>3. 性能优化<br>4. Bug 修复 | 发布版本 | 2 天 |

**前端总计**：约 15-20 工作日

### 14.3 整体里程碑
| 里程碑 | 主要交付 | 预计周期 |
| --- | --- | --- |
| **M1: 后端 MVP** | 数据库、认证、文章 CRUD、评论基础功能 | 1-1.5 周 |
| **M2: 前端公共端** | 首页、文章列表/详情、评论展示、Markdown 渲染 | 1-1.5 周 |
| **M3: 后台管理** | 后台框架、文章管理、评论管理、配置管理 | 1.5-2 周 |
| **M4: 完善与优化** | 缓存、统计、SEO、性能优化、安全加固 | 1 周 |
| **M5: 测试与部署** | 全面测试、CI/CD 配置、生产部署、文档完善 | 0.5-1 周 |

**整体预计**：5-7 周（1 人全职）或 3-4 周（2 人协作）

## 15. 测试策略
- **单元测试**：重点覆盖 Pinia store、工具函数（文件类型检测、格式化函数）。
- **组件测试**：使用 Vue Test Utils + Vitest 验证评论表单、Markdown 渲染组件。
- **端到端测试**：Cypress 覆盖关键流程：文章浏览、搜索、评论提交、后台发布。
- **性能与安全测试**：Lighthouse 性能评估、OWASP ZAP 简易扫描、上传与评论接口压力测试。

## 16. 最佳实践与开发建议

### 16.1 代码规范
- **Kotlin 编码规范**：
  - 使用数据类（data class）定义实体和 DTO。
  - 充分利用 Kotlin 特性：空安全、扩展函数、作用域函数。
  - Service 层使用接口 + 实现类分离。
  - 使用 `@Transactional` 注解保证事务一致性。
  
- **前端编码规范**：
  - 统一使用 Composition API (`<script setup>`)。
  - 组件命名采用 PascalCase，文件名使用 kebab-case。
  - Props 定义使用 TypeScript 类型或 PropType。
  - 使用 `ref` 和 `reactive` 管理响应式数据。

### 16.2 性能优化建议
- **后端优化**：
  - 使用 Redis 缓存热点数据（文章详情、热门文章、分组列表）。
  - 文章列表查询添加数据库索引（status, publish_time, views）。
  - 阅读量更新使用 Redis 缓存，定时批量写入数据库。
  - 评论查询使用分页，避免一次性加载大量数据。
  - 使用连接查询减少 N+1 查询问题。
  
- **前端优化**：
  - 文章列表使用虚拟滚动或分页加载。
  - 图片使用懒加载（Intersection Observer）。
  - 路由级别代码分割（动态 import）。
  - 使用骨架屏改善首屏加载体验。
  - Markdown 内容使用 Web Worker 解析（大文章）。

### 16.3 安全加固要点
- **后端安全**：
  - 所有用户输入进行参数校验（使用 `javax.validation`）。
  - 评论内容进行 XSS 过滤（HTML 转义）。
  - 文件上传严格校验 MIME 类型和文件扩展名。
  - 敏感接口添加频率限制（IP + 用户维度）。
  - JWT secret 使用强密码，定期轮换。
  - SQL 注入防护（MyBatis Plus 自动防护）。
  
- **前端安全**：
  - 避免使用 `v-html` 渲染用户输入内容。
  - Token 存储在 `httpOnly` cookie 或内存中。
  - 敏感操作二次确认（删除、发布）。

### 16.4 监控与日志
- **后端日志**：
  - 使用 Logback 记录关键操作日志。
  - 记录 API 请求日志（请求路径、参数、耗时、IP）。
  - 异常日志记录完整堆栈信息。
  - 使用 MDC 记录 traceId，便于追踪。
  
- **监控指标**：
  - API 响应时间监控（P50, P95, P99）。
  - 数据库连接池监控。
  - Redis 缓存命中率监控。
  - 系统资源监控（CPU、内存、磁盘）。

### 16.5 数据备份策略
- **数据库备份**：
  - 每日全量备份，保留 7 天。
  - 每小时增量备份，保留 24 小时。
  - 重要操作前手动备份。
  
- **文件备份**：
  - 文章 Markdown 内容定期导出。
  - 上传的文件（PDF、图片）备份到对象存储。
  - 配置文件纳入版本控制。

### 16.6 开发调试技巧
- **后端调试**：
  - 使用 Spring Boot DevTools 热部署。
  - 配置 H2 控制台或 MyBatis Plus SQL 日志查看执行的 SQL。
  - 使用 Postman/Apifox 保存接口测试用例。
  - 配置 Swagger UI 方便接口测试。
  
- **前端调试**：
  - 使用 Vue DevTools 查看组件状态。
  - 配置 Vite proxy 代理后端接口。
  - 使用 Pinia DevTools 追踪状态变化。
  - 浏览器 Network 面板监控接口调用。

## 17. 扩展方向与未来规划

### 17.1 功能扩展
- **内容增强**：
  - 文章系列（Series）功能，关联多篇文章。
  - 文章草稿自动保存（localStorage + 云端）。
  - 文章版本历史记录与回滚。
  - 支持更多内容格式（视频、音频嵌入）。
  
- **交互增强**：
  - 文章点赞/收藏功能。
  - 用户关注/订阅功能。
  - 站内消息通知系统。
  - 评论点赞与举报功能。
  
- **社交功能**：
  - OAuth 第三方登录（GitHub, Google）。
  - 文章分享到社交媒体（Twitter, 微博）。
  - Webhook 推送到 Discord/Telegram。
  
- **内容推荐**：
  - 基于标签的文章推荐算法。
  - 基于阅读历史的个性化推荐。
  - 相关文章智能推荐。

### 17.2 体验优化
- **阅读体验**：
  - 夜间模式 / 护眼模式。
  - 阅读进度保存与同步。
  - 字体大小、行高自定义。
  - 文章目录导航（TOC）。
  - 文章打印优化样式。
  
- **管理体验**：
  - Markdown 编辑器增强（实时预览、图片粘贴上传）。
  - 文章导入（从其他平台迁移）。
  - 批量操作优化（标签批量修改）。
  - 数据统计可视化增强。

### 17.3 技术演进
- **性能提升**：
  - 静态站点生成（SSG）提升 SEO。
  - 服务端渲染（SSR）改善首屏加载。
  - GraphQL API 替代部分 REST 接口。
  - 全文搜索引擎（Elasticsearch）。
  
- **运维增强**：
  - Docker 容器化部署。
  - Kubernetes 集群化部署。
  - 自动化监控与告警。
  - 灰度发布与 A/B 测试。

### 17.4 内容运营
- **SEO 优化**：
  - RSS 订阅源自动生成。
  - Sitemap.xml 自动更新。
  - 结构化数据（Schema.org）。
  - Open Graph 标签完善。
  
- **数据分析**：
  - Google Analytics 集成。
  - 用户行为分析（热力图）。
  - 文章阅读完成率统计。
  - 访客来源渠道分析。

### 17.5 AI 集成
- **AI 辅助写作**：
  - AI 生成文章摘要。
  - AI 推荐标签和分组。
  - AI 内容审核（敏感词、质量评估）。
  
- **智能交互**：
  - AI 评论回复建议。
  - AI 聊天助手（回答博客相关问题）。
  - AI 文章推荐（个性化推荐算法）。

## 18. 总结与后续步骤

### 18.1 方案总结
本方案提供了一个完整的个人博客系统实现方案，包括：
- ✅ 清晰的系统架构（module-home 模块）
- ✅ 详细的数据库设计（9 张核心表）
- ✅ 完整的 API 接口规范（30+ 接口）
- ✅ 前后端实施路线图（12-15 天后端 + 15-20 天前端）
- ✅ 安全性能最佳实践
- ✅ 可扩展的未来规划

### 18.2 立即开始的步骤
1. **环境准备**：
   - 确认 MySQL/PostgreSQL 数据库已就绪
   - 确认 Redis 服务已启动
   - 确认 MinIO 文件服务已配置（复用 module-file）

2. **创建 module-home 模块**：
   ```bash
   # 在项目根目录
   mkdir -p module-home/src/main/kotlin/com/zzy/home
   mkdir -p module-home/src/main/resources
   # 创建 pom.xml（参考 11.5 节）
   ```

3. **初始化数据库**：
   ```bash
   # 执行 11.3 节的 SQL 脚本创建表结构
   # 插入初始管理员账号
   ```

4. **开发第一个接口**：
   - 实现用户登录接口（/api/auth/login）
   - 实现文章列表接口（/api/articles）
   - 使用 Postman 测试接口

5. **前端搭建**：
   - 初始化 Vue 3 项目（如已有，则创建 blog 相关页面）
   - 配置路由和 Pinia store
   - 实现首页文章列表展示

### 18.3 文档维护
- 本文档应随开发进度持续更新
- 接口变更及时同步到文档
- 记录开发过程中的问题与解决方案
- 完善 API 文档（Swagger/Apifox）

---

**本文档作为博客系统的设计与实施指南，为后续开发、测试、部署提供完整参考。建议在开发前进行团队评审，确保需求理解一致。**

📝 **文档版本**：v1.1  
📅 **更新日期**：2025-10-16  
👤 **维护者**：开发团队

